## Guides
### Routing
#### Layouts and Templates
- レイアウトとは、複数のページ間で共有されるUI
	- ページ間をナビゲーションしても、レイアウトは状態を保持し、インタラクティブなままで再レンダリングされない
- `app`ディレクトリのルートに定義されるルートレイアウトは必須であり、 `<html>`タグと `<body>`タグを含める必要がある
- レイアウトは `children`プロパティを通じて子レイアウトをラップできる

#### Linking and Navigating
- Next.jsでルート間を移動するための4つの方法は以下の通り
	- 1. `<Link>`コンポーネントを使用する
	- 2. `useRouter`フックを使用する（クライアントコンポーネント）
	- 3. `redirect`関数を使用する（サーバーコンポーネント）
	- 4. ネイティブのHistory APIを使用する
- 特別な要件がない限り、ルート間のナビゲーションには `<Link>`コンポーネントの使用が推奨されている
- App Routerはルーティングとナビゲーションにハイブリッドアプローチを採用している
	- サーバー側では、アプリケーションコードがルートセグメント単位で自動的にコード分割される
	- クライアント側では、Next.js がルートセグメントをプリフェッチし、キャッシュする
	- これにより、ユーザーが新しいルートへ遷移する際にブラウザがページを再読み込みすることはなく、変更があったルートセグメントのみが再レンダリングされる
		- ナビゲーション体験とパフォーマンスが向上する

#### Error Handling
- 想定されたエラーは戻り値として扱う
	- Server Actionsでは、想定されるエラーに対して `try`/ `catch`を使わない
	- 代わりに `useActionState`を使用してエラーを管理し、クライアントに返す
- 予期しないエラーにはエラーバウンダリを使用する
	- 予期しないエラーとは、アプリケーションの通常の処理の流れでは発生しないはずのバグや問題を示すもの
		- `throw`でエラーを発生させ、それをエラーバウンダリで補足する形で処理する
	- `error.tsx`および `global-error.tsx`を使用してエラーバウンダリを実装し、予期しないエラーを処理してフォールバックUIを表示する
- サーバーコンポーネント内でデータを取得する際には、レスポンスを利用して条件に応じてエラーメッセージを表示したり、リダイレクトを実行したりできる
- 想定されたエラーとは、アプリケーションの通常の動作中に発生する可能性があるエラーのこと
	- サーバーサイドのフォームバリデーションエラーやリクエストの失敗など
- キャッチされない例外とは、アプリケーションの通常の処理の流れでは発生しないはずのバグや問題を示す予期しないエラー
	- `throw`でエラーを発生させ、それをエラーバウンダリで補足する形で処理する
- エラーバウンダリは、その子コンポーネント内で発生したエラーをキャッチし、クラッシュししたコンポーネントツリーの代わりにフォールバックUIを表示する
	- エラーが親のエラーバウンダリまで伝播するようにしたい場合は、 `error.tsx`内でレンダリング時にエラーを再スローできる
- エラーは最も近い親のエラーバウンダリまでバブルアップ（伝播）する
	- ルート階層の様々なレベルに `error.tsx`を配置することで、きめ細やかなエラー処理が可能になる
- `app/global-error.tsx`を使ってルートレイアウト内のエラーを処理することができる
	- あまり一般的ではない

#### Loading UI and Streaming
- `loading.tsx`という特別なファイルを使うことで、ReactのSuspenseと連携した意味のあるローディングUIを作成できる
- インスタントローディングステートとは、ナビゲーション直後に即座に表示されるフォールバックUIのこと
	- スケルトンやスピナーなどのローディングインジケーター、カバーフォトやタイトルなど将来的に表示される画面の一部を先に表示することで、アプリが反応していることをユーザーに伝え、より良いユーザー体験を提供できる
- `loading.tsx`をフォルダ内に追加することで、 `loading.tsx`は `layout.tsx`の内部にネストされ、 `page.tsx`やその下層のコンポーネントを自動的に `<Suspense>`でラップする
- **Next.jsはこの機能を最適化しているため、ルートセグメント（layoutsやpages）に対して `loading.tsx`を慣習的に使用することを推奨する**
- SSRでユーザーがページを見て操作できるようになるまでに、以下のような一連の処理が順番に行われる
	- 1. ページに必要な全てのデータをサーバーで取得する
	- 2. サーバーがそのデータを元にHTMLを生成する
	- 3. HTML, CSS, JavaScriptがクライアントに送信される
	- 4. サーバーで生成されたHTMLとCSSを使って、非インタラクティブなUIが表示される
	- 5. 最後にReactがハイドレーションを行い、UIがインタラクティブになる
- 上記の処理は逐次的かつブロッキングであり、すべてのデータが揃ってから初めてページがレンダリングされる