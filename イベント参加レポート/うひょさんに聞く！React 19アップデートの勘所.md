## これはなに
- [うひょさんに聞く！React 19アップデートの勘所](https://findy.connpass.com/event/318090/)に参加したので、まとめ
- スライド資料とか追加されたら追記するかも
- 13時にしゃぶしゃぶ予約しちゃったので、Q&Aは聴けないかも

## React19 RC
- React19のRCが公開されたので、それをメインに解説
- 具体的なAPIを細かく見ていくというよりは、React19時代に重要になりそうな概念などの話がメイン

## Reactの歴史
- React16
	- Hooksの時代
- React17
	- No New Features
- React18
	- Suspenseの時代
- React19
	- Actionsの時代

## Actionsって？
- ReactのActionsは、Next.jsのActionsと必ずしも同一ではない
- 非同期トランジションを使う関数のことを、慣例的にActionsと呼称する？
	- トランジションという概念自体は、React18ですでに導入されていた（useTransition）
	- 非同期の部分がReact19の新しい概念

## トランジションの性質
- 描画に時間がかかる処理のための機能
- 別のステート更新で割り込んだり、必要に応じてレンダリングをキャンセルしたり出来る
- サスペンドを起こしたレンダリングの最中に、サスペンド前のUIを残し続けたりといったことが可能になる

## React19の非同期トランジション
- startTransition関数に非同期関数を渡せる
	- この非同期関数がActionsと呼ばれている
- 非同期トランジションの実行中は、isPendingがtrueになる、完了したらfalseになる
- 非同期トランジションの挙動は、普通のトランジション + Suspenseと同じ？
	- 参照系はSuspense、更新系は非同期トランジションを使うべき
	- Suspenseは更新系の処理には向いていなかったが、非同期トランジションでそこが補完された
	- 公式ドキュメントにも、非同期トランジションは更新系の処理のための機能であることが書かれている

## useOptimistic
- 楽観的更新のためのAPI
	- 楽観的更新とは、更新リクエストを送った後、レスポンスが返ってくる前に更新後のUIを反映させること
	- 楽観的更新はステート管理が煩雑になりがち
- 元データの楽観的更新版のステートを宣言できる
- 非同期トランジションの中でaddOptimisticを呼び出すことで、楽観的更新として反映できる
	- スレートが更新されとトランジションが終了した時点で楽観的更新状態ではなくなり、値として整合性が取れた状態になる
- 具体的な構文などは公式ドキュメントを参照

## useActionState
- ステートの初期値と、ステートを更新するためのアクションを生成するためのAPI
- useReducerと近い部分がある
- useActionStateから返ってきた関数を呼び出せばアクションが実行される
- useActionStateから得られたアクション関数を使うと、自動的に非同期トランジションになる
- useTransitionとuseStateをくっつけたような便利なHooks
	- useReducerの非同期版ともいえる
	- useActionStateがあるため、非同期トランジションのためにuseTransitionを直接使う機会はあまりないかも
- 連打した時に、アクションが複数並列実行されないように制御してくれる
	- useReducerの非同期版と考えると、並列実行できないのは自然といえる

## formとアクション
- formのaction属性にアクションを渡せるようになり、フォームが送信されると渡したアクションが実行される
- 従来のonSubmitの代わりに使える
- アクションということはisPendingの概念があり、それはuseFormStatusで取得できる
	- ReactDOMからexportされている初めてのHooks
- useActionStateと組み合わせることが推奨されている

## Server Actionsとの関係
- クライアントから見れば、Sercer Actionsはアクションの一つといえる
	- 同じ非同期処理なので

## アクション系以外の新機能ダイジェスト
### メタデータ
- titleなどをレンダリングスロとheadに反映してくれるように
- スタイルシートもレンダリング可能
	- Suspense対応
	- スタイルシートが読み込まれるまで、サスペンドしてコンポーネントの表示を待ってくれる
		- CSSがあたっていない状態のUIを見せないように出来る
- スクリプトもasync属性をつけることでサスペンド対応になる
	- 謎のサードパーティスクリプトを読み込む必要があるときに便利

### Contextを直接コンポーネントとして渡せるように
- Providerの記述がいらなくなった

## React19のは破壊的変更
- 結構緩やかな印象
- 非推奨化済みの古い機能が色々削除されるので、5年以上メンテされていないコードベースは注意
- 引数のないuseRefが不可になったり、TypeScript型定義の破壊的変更のほうが破壊力が高い

## まとめ
- Reacr19で新しく登場したAPIたちは、アクションという新概念でまとめられている
	- 今回省略したuseは別
- Suspenseやトランジションという既存概念を土台にアクションを理解することが、Reacr19を使いこなす近道になる

## 感想
- Reactの新概念は、自分なりに調べて素晴らしい説明ができた、と思ったら、公式ドキュメントに同じことが最初から書いてあった、ということがよくあるらしく、やっぱり公式ドキュメントは偉大
	- Reactの公式ドキュメントはクオリティが高い
	- 妥協しないで公式ドキュメントを読んで、深く正確に理解するのが最短ルート
		- ドキュメントの更新が追いついていない場合もあるので、そういうときは個人的に調べたり実験したりする必要もある
- なんとこのイベントの後にReact19の新機能の詳細をまとめたZenn本を公開してくれるらしい、最高
- 色々と大きな変更が入って追従が大変、という印象を持っていたが、既存概念をしっかり理解していればそれを土台として理解することは簡単っぽい？
	- 概念としては理解できていても実際のコードで応用できるかは別なので、やはり手を動かして理解することが重要
- formとか値の更新、非同期処理なんかは実際のフロントエンド開発でも頻出かつ重要な要素だと思うので、このタイミングで一回しっかりと土台から理解したいと感じた